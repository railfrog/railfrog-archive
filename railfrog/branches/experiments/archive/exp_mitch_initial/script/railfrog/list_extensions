#!/usr/bin/env ruby

def load_extensions_array
  extensions = []
  installed = Extension.find(:all)
  
  Dir.foreach(Extension.path) do |ext_file|
    installed_ext = installed.detect { |inext| inext.name.downcase == ext_file.downcase }
    if File.exists?(Extension.generate_filename(ext_file)) and File.exists?(Extension.generate_yaml_filename(ext_file)) then
      yaml_data = Extension.load_yaml_data(ext_file)
      yaml_data['installed'] = installed_ext.nil? ? false : true
      require_dependency Extension.generate_filename(ext_file)
      eval 'yaml_data[\'type\'] = ' + Extension.generate_classname(ext_file) + '.type'
      extensions.push(yaml_data)
    end
  end
  
  extensions
end

print 'Loading railfrog system...'
require 'config/environment'
puts 'Done'

print "\n"
puts '=== Listing All Extensions ==='
puts 'Name'.ljust(20) + 'Raw Name'.ljust(15) + 'Type'.ljust(15) + 'Installed?'

load_extensions_array.each do |ext|
  puts ext.name.ljust(20) + ext.raw_name.ljust(15) + ext['type'].ljust(15) + ext.installed.to_s
end