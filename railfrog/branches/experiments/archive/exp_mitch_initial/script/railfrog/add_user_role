#!/usr/bin/env ruby

print 'Loading railfrog system...'
require 'config/environment'
puts 'Done'

print "\n"
puts "=== ADD ROLE TO USER ==="
print 'Login: '
login_name = $stdin.gets.chomp

if (user = User.find_by_login(login_name)).nil?
  print "\n"
  puts "ERROR: User with that login doesn't exist."
  exit
end

print 'Role(s), more than one separated by a comma: '
role_names = $stdin.gets.chomp

roles = Role.find(:all)

roles_to_add = []
role_names.each do |role_name|
  role = roles.detect { |role| role.name == role_name or role.translate == role_name }
  
  if role.nil?
    print "\n"
    puts "ERROR: Couldn't find a role named '#{role_name}'"
    exit
  end
  
  roles_to_add.push(role)
end

roles_to_add.each do |role|
  begin
    user.add_role(role)
  rescue UserAlreadyHasRoleException
  end
end

print "\n"
puts "Role(s) added to user."